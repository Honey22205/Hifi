{% extends "delivery_agent/index.html" %}
{% block content %}
<header>
  <h1>Delivery Partner Dashboard</h1>
  <div class="admin-card">
    <img
      src="https://img.lovepik.com/element/45001/3052.png_860.png"
      alt="Profile"
      class="profile-image"
    />
    <div class="admin-info">
      <p><strong>{{ user.username }}</strong></p>
      <p class="role">Delivery Partner</p>
    </div>
  </div>
</header>

<section class="dashboard-stats">
  <div class="card">
    📈 Total Orders Today
    <h2>{{ todays_deliveries_count }}</h2>
  </div>
  <div class="card completed">
    🛍️ Completed Orders
    <h2>{{ completed_count }}</h2>
  </div>
  <div class="card pending">
    📊 Pending Orders
    <h2>{{ pending_count }}</h2>
  </div>
</section>

<section class="recent-orders">
  <h2>Recent Orders</h2>
  {% if pending_orders %}
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Order Time</th>
        <th>Customer Details</th>
        <th>Delivery Location</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for order in pending_orders %}
      <tr>
        <td>OD{{ order.order_id }}</td>
        <td>{{ order.order_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td>
          {{ order.customer_name }}<br />
          {{ order.customer_phone }}
        </td>
        <td>{{ order.delivery_location }}</td>
        <td>{% if order.order_status == "Pending" %}
            <span class="status-value pending" id="orderStatus"
              >{{ order.order_status }}</span
            >
            {% elif order.order_status == "Completed" %}
            <span class="status-value completed" id="orderStatus"
              >{{ order.order_status }}</span
            >
            {% elif order.order_status == "In Progress" %}
            <span class="status-value in-progress" id="orderStatus"
              >{{ order.order_status }}</span
            >
            {% else %}
            <span class="status-value" id="orderStatus"
              >{{ order.order_status }}</span
            >
            {% endif %}</td>
        <td>
          <a href="{{ url_for('delivery_partner_order_detail', order_id=order.order_id) }}">Details</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No pending orders assigned to you.</p>
  {% endif %}
</section>

<section class="recent-orders">
  <h2>Assigned Deliveries</h2>
  {% if assigned_orders %}
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Scheduled Delivery Time</th>
        <th>Customer Details</th>
        <th>Delivery Location</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for order in assigned_orders %}
      <tr>
        <td>OD{{ order.order_id }}</td>
        <td>{{ order.order_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td>
          {{ order.customer_name }}<br />
          {{ order.customer_phone }}
        </td>
        <td>{{ order.delivery_location }}</td>
        <td>{{ order.order_status }}</td>
        <td>
          <a href="{{ url_for('delivery_partner_order_detail', order_id=order.order_id) }}">Details</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No assigned orders.</p>
  {% endif %}
</section>

<section class="recent-orders">
  <h2>Completed Deliveries</h2>
  {% if completed_orders %}
  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Delivery Date & Time</th>
        <th>Customer Details</th>
        <th>Delivery Location</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for order in completed_orders %}
      <tr>
        <td>OD{{ order.order_id }}</td>
        <td>{{ order.order_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td>
          {{ order.customer_name }}<br />
          {{ order.customer_phone }}
        </td>
        <td>{{ order.delivery_location }}</td>
        <td>{{ order.order_status }}</td>
        <td>
          <a href="{{ url_for('delivery_partner_order_detail', order_id=order.order_id) }}">Details</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>No completed orders.</p>
  {% endif %}
</section>

<div class="side-info">
  <div class="side-card">
    <h3>Recent Updates</h3>
    <p>Abdul received his order of Mutton Kheema</p>
    <p>Kalyan received his order of Dosa</p>
  </div>
  <div class="side-card">
    <h3>Agent Ranking</h3>
    <p>⭐ Ali Muhammad<br />Last seen 2 hours ago</p>
  </div>
</div>
{% endblock content %}
